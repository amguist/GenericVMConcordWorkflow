configuration:
  dependencies:

  arguments:
    concordPid: ${txId}
    concordServerUrl: "http://localhost:8001/#/process"

  meta:
    artifactId: ""
    version: ""
    completedStage: ""

flows:
  default:
    - log: "Process ID is ${concordPid}"
    - form: deploymentForm
    - set:
        groupId: ${deploymentForm.groupId}
        artifactId: ${deploymentForm.artifactId}
        version: ${deploymentForm.version}
        environment: ${deploymentForm.environment}
    - switch: ${environment}
      Development:
        - form: developmentForm
        - set:
            serverUrl: ${developmentForm.serverAddress}
        - call: targetDeployment
          in: 
            targetEnv: ${environment}
            targetURL: ${serverUrl}
      default:
        - log: "Environment will be: ${environment}"

  targetDeployment:
    - if: ${targetURL != ""}
      then:
        - log: "************************************************************************************************"
        - log: "** Initiating Deployment Prerequisites to deploy to [ ${environment} ]                       ** "
        - log: "************************************************************************************************"
        - try:
          - if: ${targetEnv != "Production"}
            then:
              - log: "****************************************************************************"
              - log: "** Performing deployment to Non-Production Environment: [ ${targetEnv} ]  **"
              - log: "****************************************************************************"
            else:
              - log: "****************************************************************************"
              - log: "** Performing deployment to Production Environment: [ ${targetEnv} ]  **"
              - log: "****************************************************************************"
          error:
            - log: "Exception has been caught --- ${lastError.getCause()}
            - throw: ${lastError.message}
        

forms:
  deploymentForm:
    - groupId: { label: "Group Identifier", type: "string", placeholder: "Input Artifact Group Identifier"}
    - artifactId: { label: "Artifact Identifier", type: "string", placeholder: "Input Artifact Group Identifier"}
    - version: { label: "Artifact Version", type: "string", placeholder: "Input Artifact Version"}
    - environment: { label: "Environment", type: "string", placeholder: "Select Environment Type", allow: ["Development","QA","Stage","Performance","Production"]}

  developmentForm:
    - serverAddress: { label: "Server Address", type: "string", placeholder: "Input Server Address(es)"}

